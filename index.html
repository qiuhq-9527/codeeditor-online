<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Document</title>
  <script src="https://cdn.jsdelivr.net/npm/less@4.2.0/dist/less.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.2/ace.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.2/ext-language_tools.min.js"></script>
  <link rel="stylesheet" href="style.css">
  <script src="aceEditor.js"></script>
  <script src="codeRunner.js"></script>
</head>

<body>
  <div class="container">

    <div class="title">
      <div>CodeEdit-Online</div>
      <div class="theme-switcher">
        <div class="theme-option" data-theme="light" title="浅色主题"></div>
        <div class="theme-option" data-theme="dark" title="深色主题"></div>
        <div class="theme-option" data-theme="auto" title="跟随系统"></div>
      </div>
    </div>

    <div class="content">
      <!-- 代码编写区 -->
      <div class="content-code">
        <div class="code-title">
          <span>代码</span>
        </div>
      </div>

      <div class="divider divider-x" id="dividerX"></div>

      <!-- 数据区 -->
      <div class="content-data">
        <!-- 数据输入区 -->
        <div class="content-input">
          <div class="input-title">
            <span>输入</span>
          </div>

          <form class="input-form" id="inputForm">
            <textarea class="content-input-textarea" name="inputData" placeholder="请输入数据"></textarea>
            <button type="submit" class="run-button">
              <span>运行</span>
            </button>
          </form>
        </div>

        <div class="divider divider-y" id="dividerY"></div>

        <!-- 运行结果区 -->
        <div class="content-output">
          <div class="output-title">
            <span>输出</span>
          </div>
          <div class="output-content-container">
            <div class="output-content empty" id="outputContent">请运行代码</div>
          </div>
        </div>
      </div>
    </div>

  </div>


</body>

<script>
  /**
   * @description 主题切换管理
   */
  class ThemeManager {
    constructor() {
      this.currentTheme = localStorage.getItem("theme") || "auto";
      this.init();
    }

    init() {
      this.applyTheme(this.currentTheme);

      document.querySelectorAll(".theme-option").forEach((option) => {
        option.addEventListener("click", () => {
          const theme = option.getAttribute("data-theme");
          this.setTheme(theme);
        });
      });

      window
        .matchMedia("(prefers-color-scheme: dark)")
        .addEventListener("change", (e) => {
          if (this.currentTheme === "auto") {
            this.applyTheme("auto");
          }
        });
    }

    setTheme(theme) {
      this.currentTheme = theme;
      localStorage.setItem("theme", theme);
      this.applyTheme(theme);
    }

    applyTheme(theme) {
      document.documentElement.removeAttribute("data-theme");

      if (theme === "auto") {
        const systemPrefersDark = window.matchMedia(
          "(prefers-color-scheme: dark)"
        ).matches;
        if (systemPrefersDark) {
          document.documentElement.setAttribute("data-theme", "dark");
        } else {
          document.documentElement.setAttribute("data-theme", "light");
        }
      } else {
        document.documentElement.setAttribute("data-theme", theme);
      }
    }
  }

  // 初始化
  document.addEventListener("DOMContentLoaded", () => {
    new ThemeManager();
  });
</script>

<script>
  /**
   * @description 布局调整管理
   */
  class ResizeManager {
    constructor() {
      this.code = document.querySelector('.content-code');
      this.data = document.querySelector('.content-data');
      this.input = document.querySelector('.content-input');
      this.output = document.querySelector('.content-output');
      this.dividerX = document.getElementById('dividerX');
      this.dividerY = document.getElementById('dividerY');

      this.minWidth = 12; // rem
      this.minHeight = 12; // rem
      this.throttleDelay = 16; // ms
      this.lastTime = 0;

      this.codeWidth = 56;
      this.dataWidth = 44;
      this.inputHeight = 25;
      this.outputHeight = 75;

      this.applyLayout();
      this.dividerX.addEventListener('mousedown', (e) => this.dragX(e));
      this.dividerY.addEventListener('mousedown', (e) => this.dragY(e));
    }

    applyLayout() {
      this.code.style.width = this.codeWidth + '%';
      this.data.style.width = this.dataWidth + '%';
      this.input.style.height = this.inputHeight + '%';
      this.output.style.height = this.outputHeight + '%';
    }

    throttle(fn) {
      const now = Date.now();
      if (now - this.lastTime >= this.throttleDelay) {
        this.lastTime = now;
        fn();
      }
    }

    dragX(e) {
      e.preventDefault();
      const container = document.querySelector('.content');
      const startX = e.clientX;
      const startCodeW = this.code.offsetWidth;
      const startDataW = this.data.offsetWidth;
      const totalW = container.offsetWidth;
      const minW = this.minWidth * 16; 

      const move = (ev) => {
        this.throttle(() => {
          const delta = ev.clientX - startX;
          const newCodeW = startCodeW + delta;
          const newDataW = startDataW - delta;

          if (newCodeW < minW || newDataW < minW) return;

          this.codeWidth = (newCodeW / totalW) * 100;
          this.dataWidth = (newDataW / totalW) * 100;
          this.applyLayout();
        });
      };

      const end = () => {
        window.removeEventListener('mousemove', move);
        window.removeEventListener('mouseup', end);
      };

      window.addEventListener('mousemove', move);
      window.addEventListener('mouseup', end);
    }

    dragY(e) {
      e.preventDefault();
      const startY = e.clientY;
      const startInputH = this.input.offsetHeight;
      const startOutputH = this.output.offsetHeight;
      const totalH = this.data.offsetHeight;
      const minH = this.minHeight * 16; 

      const move = (ev) => {
        this.throttle(() => {
          const delta = ev.clientY - startY;
          const newInputH = startInputH + delta;
          const newOutputH = startOutputH - delta;

          if (newInputH < minH || newOutputH < minH) return;

          this.inputHeight = (newInputH / totalH) * 100;
          this.outputHeight = (newOutputH / totalH) * 100;
          this.applyLayout();
        });
      };

      const end = () => {
        window.removeEventListener('mousemove', move);
        window.removeEventListener('mouseup', end);
      };

      window.addEventListener('mousemove', move);
      window.addEventListener('mouseup', end);
    }
  }

  document.addEventListener("DOMContentLoaded", () => {
    new ResizeManager();
  });
</script>


</html>